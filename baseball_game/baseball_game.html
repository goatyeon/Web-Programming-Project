<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>숫자 야구 게임</title>
  
</head>
<body>
  <div class="game-container">
    <h1>숫자 야구 게임</h1>
    <p>레벨을 선택하세요:</p>
    <button onclick="startGame(3)">3자리</button>
    <button onclick="startGame(4)">4자리</button>
    <button onclick="startGame(5)">5자리</button>
    <p>현재 레벨: <span id="level">3</span></p>
    <input type="text" id="guess" maxlength="5" placeholder="숫자 입력" />
    <button onclick="checkGuess()">시도</button>
    <button onclick="getHint()">힌트 (-20점)</button>
    <div class="timer" id="timer"></div>
    <div class="result" id="result"></div>
    <div class="history" id="history"></div>
    <div class="hint" id="hint"></div>
    <div id="strike-ball"></div>
    <div class="scoreboard">
      <p>점수: <span id="score">0</span></p>
      <p>시도 횟수: <span id="attempts">0</span></p>
      <p>남은 힌트: <span id="hint-count">3</span></p>
    </div>
  </div>

  <script>
    let randomNumber = '';
    let attempts = 0;
    let score = 0;
    let level = 3; // 기본 레벨 3자리
    let hintCount = 3;
    let countdown = 90; // 1분 30초
    let gameTimer;
    let gameActive = false;

    // 게임 시작 시 레벨 설정
    function startGame(selectedLevel) {
      level = selectedLevel;
      document.getElementById('level').textContent = level;
      randomNumber = generateNumber(level);
      attempts = 0;
      score = 0;
      hintCount = 3;
      countdown = 90;
      gameActive = true;
      updateUI();
      startTimer();
    }

    // 레벨에 맞는 숫자 생성
    function generateNumber(level) {
      let number;
      do {
        number = Math.floor(Math.random() * Math.pow(10, level)) + Math.pow(10, level - 1);
      } while (new Set(number.toString()).size !== level);
      return number.toString();
    }

    // 타이머 업데이트
    function startTimer() {
      gameTimer = setInterval(function () {
        countdown--;
        document.getElementById('timer').textContent = `남은 시간: ${countdown}초`;
        if (countdown <= 0) {
          clearInterval(gameTimer);
          gameActive = false;
          document.getElementById('timer').textContent = '시간 초과!';
          alert('시간이 초과되었습니다!');
          resetGame();
        }
      }, 1000);
    }

    // 힌트 버튼 클릭 시 점수 차감 후 힌트 제공
    function getHint() {
      if (gameActive && hintCount > 0 && score >= 20) {
        hintCount--;
        score -= 20;
        document.getElementById('score').textContent = score;
        document.getElementById('hint-count').textContent = hintCount;
        let hintMessage = '';
        for (let i = 0; i < level; i++) {
          let num = parseInt(randomNumber[i]);
          hintMessage += `${i + 1}번째 자리는 ${num % 2 === 0 ? '짝수' : '홀수'}입니다. `;
        }
        document.getElementById('hint').textContent = `힌트: ${hintMessage}`;
      } else if (score < 20) {
        alert('점수가 부족합니다.');
      } else {
        alert('더 이상 힌트를 사용할 수 없습니다.');
      }
    }

    // 스트라이크와 볼 계산
    function checkStrikeBall(guess) {
      let strike = 0;
      let ball = 0;
      for (let i = 0; i < level; i++) {
        if (guess[i] === randomNumber[i]) {
          strike++;
        } else if (randomNumber.includes(guess[i])) {
          ball++;
        }
      }
      return [strike, ball];
    }

    // 답을 체크하는 함수
    function checkGuess() {
      if (!gameActive) return;
      const guess = document.getElementById('guess').value;
      if (guess.length !== level || isNaN(guess)) {
        alert(`다시 입력해주세요. ${level}자리 숫자를 입력해야 합니다.`);
        return;
      }

      attempts++;
      const [strike, ball] = checkStrikeBall(guess);
      score += 10;
      document.getElementById('score').textContent = score;
      document.getElementById('attempts').textContent = attempts;

      document.getElementById('result').innerHTML = `${strike} 스트라이크, ${ball} 볼`;
      logHistory(guess, strike, ball);
      updateStrikeBallIcons(strike, ball);

      if (strike === level) {
        clearInterval(gameTimer); // 정답을 맞히면 타이머를 멈춘다.
        setTimeout(() => {
          alert(`정답입니다! 총 점수는 ${score}점입니다.`);
          resetGame();
        }, 500);
      }
    }

    // 사용자의 입력 로그 기록
    function logHistory(guess, strike, ball) {
      const history = document.getElementById('history');
      history.innerHTML += `<div>입력: ${guess} → 결과: ${strike} 스트라이크, ${ball} 볼</div>`;
    }

    // 스트라이크, 볼 아이콘 업데이트
    function updateStrikeBallIcons(strike, ball) {
      let icons = '';
      for (let i = 0; i < strike; i++) {
        icons += '<span class="icon">⚾</span>';
      }
      for (let i = 0; i < ball; i++) {
        icons += '<span class="icon">⭕</span>';
      }
      document.getElementById('strike-ball').innerHTML = icons;
    }

    // 게임 상태 업데이트
    function updateUI() {
      document.getElementById('strike-ball').innerHTML = '';
      document.getElementById('hint').textContent = '';
      document.getElementById('result').textContent = '';
    }

    // 게임 초기화
    function resetGame() {
      gameActive = false;
      document.getElementById('timer').textContent = '게임 종료';
    }

  </script>
</body>
</html>
